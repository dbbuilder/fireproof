import{b as i,f as t,g as n,r as L,c as b,o as U,y as T,x as O,h as v,s as Y,I as u,t as o,q as w,v as q,C as A,E as D,F as g,D as y,e as I,A as V}from"./vendor-8rVgzruD.js";import{u as G}from"./inspections-DmLkn9Y3.js";import{u as H}from"./extinguishers-BkjuEnvJ.js";import{u as z}from"./locations-e0sVBKke.js";import{u as Z,r as J}from"./XCircleIcon-CdsB511z.js";import{b as K,d as Q,r as W,A as X}from"./AppLayout-DVMZMm7i.js";import{r as tt}from"./ChartBarIcon-MENjFshL.js";import{r as et}from"./CheckCircleIcon-Bq29seAH.js";import"./index-DcSKaWik.js";import"./BuildingOfficeIcon-BZlVraTP.js";import"./XMarkIcon-C76yCGqv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InformationCircleIcon-B2m1JJFM.js";function st(F,c){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}function at(F,c){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z"})])}const ot={class:"flex justify-between items-center mb-8"},nt=["disabled"],it={class:"card mb-8"},lt={class:"card-body"},rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},dt=["value"],ct={class:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200"},ut={class:"text-sm text-gray-600"},pt={key:0,class:"card"},vt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8","data-testid":"overview-stats"},xt={class:"card","data-testid":"stat-card-total"},mt={class:"p-6"},gt={class:"flex items-center justify-between mb-2"},yt={class:"text-3xl font-bold text-gray-900","data-testid":"total-inspections"},ft={class:"card","data-testid":"stat-card-passrate"},ht={class:"p-6"},_t={class:"flex items-center justify-between mb-2"},bt={class:"text-3xl font-bold text-green-600","data-testid":"pass-rate"},wt={class:"text-xs text-gray-500 mt-1"},Dt={class:"card","data-testid":"stat-card-service"},It={class:"p-6"},Rt={class:"flex items-center justify-between mb-2"},kt={class:"text-3xl font-bold text-amber-600","data-testid":"require-service"},St={class:"card","data-testid":"stat-card-replacement"},Ct={class:"p-6"},Tt={class:"flex items-center justify-between mb-2"},Ft={class:"text-3xl font-bold text-red-600","data-testid":"require-replacement"},Nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8","data-testid":"charts-section"},$t={class:"card","data-testid":"inspections-by-type-card"},jt={class:"card-body"},Lt={key:0,class:"space-y-3"},qt={class:"flex items-center flex-1"},At={class:"text-sm font-medium text-gray-700 w-24"},Vt={class:"flex-1 mx-4"},Bt={class:"w-full bg-gray-200 rounded-full h-2"},Mt={class:"text-sm font-semibold text-gray-900 w-12 text-right"},Pt={key:1,class:"text-center py-8 text-gray-500"},Et={class:"card","data-testid":"pass-fail-distribution-card"},Ut={class:"card-body"},Ot={key:0,class:"space-y-4"},Yt={class:"flex items-center justify-between"},Gt={class:"flex items-center flex-1"},Ht={class:"flex-1 mx-4"},zt={class:"w-full bg-gray-200 rounded-full h-2"},Zt={class:"text-sm font-semibold text-gray-900 w-16 text-right"},Jt={class:"flex items-center justify-between"},Kt={class:"flex items-center flex-1"},Qt={class:"flex-1 mx-4"},Wt={class:"w-full bg-gray-200 rounded-full h-2"},Xt={class:"text-sm font-semibold text-gray-900 w-16 text-right"},te={class:"pt-6 border-t border-gray-200","data-testid":"visual-pie-chart"},ee={class:"flex items-center justify-center space-x-2"},se={key:0,class:"text-white font-bold text-sm"},ae={key:0,class:"text-white font-bold text-sm"},oe={key:1,class:"text-center py-8 text-gray-500"},ne={class:"card mb-8","data-testid":"inspections-by-location-card"},ie={class:"card-body"},le={key:0,class:"space-y-3"},re={class:"flex items-center flex-1"},de={class:"flex-1"},ce={class:"font-medium text-gray-900"},ue={class:"text-xs text-gray-500"},pe={class:"flex items-center space-x-6"},ve={class:"text-center"},xe={class:"text-sm font-semibold text-gray-900"},me={class:"text-center"},ge={class:"text-sm font-semibold text-green-600"},ye={class:"text-center"},fe={class:"text-sm font-semibold text-red-600"},he={class:"text-center min-w-[60px]"},_e={key:1,class:"text-center py-8 text-gray-500"},be={class:"card","data-testid":"recent-activity-card"},we={class:"card-body"},De={key:0,class:"space-y-3"},Ie={class:"flex items-center flex-1"},Re={class:"flex-1"},ke={class:"flex items-center space-x-2"},Se={class:"font-medium text-gray-900"},Ce={class:"badge-primary text-xs"},Te={class:"text-sm text-gray-600"},Fe={class:"flex items-center space-x-2"},Ne={key:0,class:"badge-warning text-xs"},$e={key:1,class:"badge-danger text-xs"},je={key:1,class:"text-center py-8 text-gray-500"},ze={__name:"ReportsView",setup(F){const c=G(),R=H(),k=z(),x=Z(),f=L(!1),S=()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-30),{startDate:e.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]}},r=L({startDate:S().startDate,endDate:S().endDate,locationId:"",inspectionType:""}),l=b(()=>c.stats?c.stats:{totalInspections:0,passedInspections:0,failedInspections:0,requireingService:0,requiringReplacement:0,passRate:0}),N=b(()=>c.inspectionsByType||{}),$=b(()=>c.recentInspections.slice(0,10)),j=b(()=>{const a=[];for(const e of k.locations){const s=R.extinguishers.filter(p=>p.locationId===e.locationId),d=c.inspections.filter(p=>{const _=R.getExtinguisherById(p.extinguisherId);return _&&_.locationId===e.locationId});if(d.length>0){const p=d.filter(C=>C.passed).length,_=d.filter(C=>!C.passed).length,E=d.length>0?p/d.length*100:0;a.push({locationId:e.locationId,locationName:e.locationName,extinguisherCount:s.length,inspectionCount:d.length,passed:p,failed:_,passRate:E})}}return a.sort((e,s)=>s.inspectionCount-e.inspectionCount)});U(async()=>{try{await Promise.all([c.fetchInspections(),c.fetchStats(r.value.startDate,r.value.endDate),R.fetchExtinguishers(),k.fetchLocations()])}catch(a){console.error("Failed to load report data:",a),x.error("Failed to load reports")}});const m=async()=>{try{const a={startDate:r.value.startDate,endDate:r.value.endDate};r.value.inspectionType&&(a.inspectionType=r.value.inspectionType),await Promise.all([c.fetchInspections(a),c.fetchStats(r.value.startDate,r.value.endDate)])}catch(a){console.error("Failed to apply filters:",a),x.error("Failed to apply filters")}},B=async()=>{const a=S();r.value={startDate:a.startDate,endDate:a.endDate,locationId:"",inspectionType:""},await m()},M=async()=>{f.value=!0;try{x.info("Generating report..."),await new Promise(p=>setTimeout(p,2e3));const a=P(),e=new Blob([a],{type:"text/csv"}),s=window.URL.createObjectURL(e),d=document.createElement("a");d.href=s,d.download=`inspection-report-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(s),x.success("Report generated successfully")}catch(a){console.error("Failed to generate report:",a),x.error("Failed to generate report")}finally{f.value=!1}},P=()=>{let a=`Date,Extinguisher,Location,Type,Inspector,Status,Requires Service,Requires Replacement
`;for(const e of c.inspections)a+=`${h(e.inspectionDate)},`,a+=`${e.extinguisherCode},`,a+=`${e.locationName||"N/A"},`,a+=`${e.inspectionType},`,a+=`${e.inspectorName||"N/A"},`,a+=`${e.passed?"Passed":"Failed"},`,a+=`${e.requiresService?"Yes":"No"},`,a+=`${e.requiresReplacement?"Yes":"No"}
`;return a},h=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return(a,e)=>(n(),T(X,null,{default:O(()=>[t("div",null,[t("div",ot,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-3xl font-display font-semibold text-gray-900 mb-2","data-testid":"reports-heading"}," Reports & Analytics "),t("p",{class:"text-gray-600"}," Generate compliance reports and view analytics ")],-1)),t("button",{class:"btn-primary inline-flex items-center",disabled:f.value,"data-testid":"generate-report-button",onClick:M},[v(u(st),{class:"h-5 w-5 mr-2"}),Y(" "+o(f.value?"Generating...":"Generate Report"),1)],8,nt)]),t("div",it,[e[11]||(e[11]=t("div",{class:"card-header"},[t("h2",{class:"text-lg font-semibold text-gray-900"}," Report Filters ")],-1)),t("div",lt,[t("div",rt,[t("div",null,[e[5]||(e[5]=t("label",{for:"startDate",class:"form-label"},"Start Date",-1)),w(t("input",{id:"startDate","onUpdate:modelValue":e[0]||(e[0]=s=>r.value.startDate=s),type:"date",class:"form-input",onChange:m},null,544),[[q,r.value.startDate]])]),t("div",null,[e[6]||(e[6]=t("label",{for:"endDate",class:"form-label"},"End Date",-1)),w(t("input",{id:"endDate","onUpdate:modelValue":e[1]||(e[1]=s=>r.value.endDate=s),type:"date",class:"form-input",onChange:m},null,544),[[q,r.value.endDate]])]),t("div",null,[e[8]||(e[8]=t("label",{for:"location",class:"form-label"},"Location",-1)),w(t("select",{id:"location","onUpdate:modelValue":e[2]||(e[2]=s=>r.value.locationId=s),class:"form-input",onChange:m},[e[7]||(e[7]=t("option",{value:""}," All Locations ",-1)),(n(!0),i(g,null,D(u(k).locations,s=>(n(),i("option",{key:s.locationId,value:s.locationId},o(s.locationName),9,dt))),128))],544),[[A,r.value.locationId]])]),t("div",null,[e[10]||(e[10]=t("label",{for:"inspectionType",class:"form-label"},"Inspection Type",-1)),w(t("select",{id:"inspectionType","onUpdate:modelValue":e[3]||(e[3]=s=>r.value.inspectionType=s),class:"form-input",onChange:m},[...e[9]||(e[9]=[t("option",{value:""}," All Types ",-1),t("option",{value:"Monthly"}," Monthly ",-1),t("option",{value:"Annual"}," Annual ",-1),t("option",{value:"5-Year"}," 5-Year ",-1),t("option",{value:"12-Year"}," 12-Year ",-1)])],544),[[A,r.value.inspectionType]])])]),t("div",ct,[t("div",ut," Showing data from "+o(h(r.value.startDate))+" to "+o(h(r.value.endDate)),1),t("button",{class:"btn-outline text-sm",onClick:B}," Reset Filters ")])])]),u(c).loading?(n(),i("div",pt,[...e[12]||(e[12]=[t("div",{class:"p-12 text-center"},[t("div",{class:"spinner-lg mx-auto mb-4"}),t("p",{class:"text-gray-600"}," Loading analytics... ")],-1)])])):(n(),i(g,{key:1},[t("div",vt,[t("div",xt,[t("div",mt,[t("div",gt,[e[13]||(e[13]=t("span",{class:"text-sm font-medium text-gray-500"},"Total Inspections",-1)),v(u(K),{class:"h-8 w-8 text-gray-400"})]),t("div",yt,o(l.value.totalInspections),1),e[14]||(e[14]=t("p",{class:"text-xs text-gray-500 mt-1"}," In selected period ",-1))])]),t("div",ft,[t("div",ht,[t("div",_t,[e[15]||(e[15]=t("span",{class:"text-sm font-medium text-gray-500"},"Pass Rate",-1)),v(u(tt),{class:"h-8 w-8 text-green-400"})]),t("div",bt,o((l.value.passRate||0).toFixed(1))+"% ",1),t("p",wt,o(l.value.passedInspections)+" passed, "+o(l.value.failedInspections)+" failed ",1)])]),t("div",Dt,[t("div",It,[t("div",Rt,[e[16]||(e[16]=t("span",{class:"text-sm font-medium text-gray-500"},"Require Service",-1)),v(u(at),{class:"h-8 w-8 text-amber-400"})]),t("div",kt,o(l.value.requireingService),1),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mt-1"}," Need maintenance ",-1))])]),t("div",St,[t("div",Ct,[t("div",Tt,[e[18]||(e[18]=t("span",{class:"text-sm font-medium text-gray-500"},"Require Replacement",-1)),v(u(Q),{class:"h-8 w-8 text-red-400"})]),t("div",Ft,o(l.value.requiringReplacement),1),e[19]||(e[19]=t("p",{class:"text-xs text-gray-500 mt-1"}," Critical attention ",-1))])])]),t("div",Nt,[t("div",$t,[e[20]||(e[20]=t("div",{class:"card-header"},[t("h3",{class:"text-lg font-semibold text-gray-900"}," Inspections by Type ")],-1)),t("div",jt,[Object.keys(N.value).length>0?(n(),i("div",Lt,[(n(!0),i(g,null,D(N.value,(s,d)=>(n(),i("div",{key:d,class:"flex items-center justify-between"},[t("div",qt,[t("span",At,o(d),1),t("div",Vt,[t("div",Bt,[t("div",{class:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:y({width:`${s.length/l.value.totalInspections*100}%`})},null,4)])]),t("span",Mt,o(s.length),1)])]))),128))])):(n(),i("div",Pt," No inspection data available "))])]),t("div",Et,[e[25]||(e[25]=t("div",{class:"card-header"},[t("h3",{class:"text-lg font-semibold text-gray-900"}," Pass/Fail Distribution ")],-1)),t("div",Ut,[l.value.totalInspections>0?(n(),i("div",Ot,[t("div",Yt,[t("div",Gt,[e[21]||(e[21]=t("div",{class:"w-3 h-3 rounded-full bg-green-500 mr-3"},null,-1)),e[22]||(e[22]=t("span",{class:"text-sm font-medium text-gray-700 w-20"},"Passed",-1)),t("div",Ht,[t("div",zt,[t("div",{class:"bg-green-500 h-2 rounded-full transition-all duration-300",style:y({width:`${l.value.passRate}%`})},null,4)])]),t("span",Zt,o(l.value.passedInspections)+" ("+o((l.value.passRate||0).toFixed(1))+"%) ",1)])]),t("div",Jt,[t("div",Kt,[e[23]||(e[23]=t("div",{class:"w-3 h-3 rounded-full bg-red-500 mr-3"},null,-1)),e[24]||(e[24]=t("span",{class:"text-sm font-medium text-gray-700 w-20"},"Failed",-1)),t("div",Qt,[t("div",Wt,[t("div",{class:"bg-red-500 h-2 rounded-full transition-all duration-300",style:y({width:`${100-l.value.passRate}%`})},null,4)])]),t("span",Xt,o(l.value.failedInspections)+" ("+o((100-(l.value.passRate||0)).toFixed(1))+"%) ",1)])]),t("div",te,[t("div",ee,[t("div",{"data-testid":"visual-pie-chart-green",class:"h-24 rounded-lg bg-green-500 transition-all duration-300 flex items-center justify-center",style:y({width:`${l.value.passRate}%`})},[l.value.passRate>20?(n(),i("span",se,o((l.value.passRate||0).toFixed(0))+"% ",1)):I("",!0)],4),t("div",{"data-testid":"visual-pie-chart-red",class:"h-24 rounded-lg bg-red-500 transition-all duration-300 flex items-center justify-center",style:y({width:`${100-l.value.passRate}%`})},[100-l.value.passRate>20?(n(),i("span",ae,o((100-(l.value.passRate||0)).toFixed(0))+"% ",1)):I("",!0)],4)])])])):(n(),i("div",oe," No inspection data available "))])])]),t("div",ne,[e[30]||(e[30]=t("div",{class:"card-header"},[t("h3",{class:"text-lg font-semibold text-gray-900"}," Inspections by Location ")],-1)),t("div",ie,[j.value.length>0?(n(),i("div",le,[(n(!0),i(g,null,D(j.value,s=>(n(),i("div",{key:s.locationId,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[t("div",re,[v(u(W),{class:"h-5 w-5 text-gray-400 mr-3"}),t("div",de,[t("div",ce,o(s.locationName),1),t("div",ue,o(s.extinguisherCount)+" extinguishers ",1)])]),t("div",pe,[t("div",ve,[t("div",xe,o(s.inspectionCount),1),e[26]||(e[26]=t("div",{class:"text-xs text-gray-500"}," Inspections ",-1))]),t("div",me,[t("div",ge,o(s.passed),1),e[27]||(e[27]=t("div",{class:"text-xs text-gray-500"}," Passed ",-1))]),t("div",ye,[t("div",fe,o(s.failed),1),e[28]||(e[28]=t("div",{class:"text-xs text-gray-500"}," Failed ",-1))]),t("div",he,[t("div",{class:V(["text-sm font-semibold",[s.passRate>=90?"text-green-600":s.passRate>=70?"text-amber-600":"text-red-600"]])},o((s.passRate||0).toFixed(1))+"% ",3),e[29]||(e[29]=t("div",{class:"text-xs text-gray-500"}," Pass Rate ",-1))])])]))),128))])):(n(),i("div",_e," No location data available "))])]),t("div",be,[e[31]||(e[31]=t("div",{class:"card-header"},[t("h3",{class:"text-lg font-semibold text-gray-900"}," Recent Inspection Activity ")],-1)),t("div",we,[$.value.length>0?(n(),i("div",De,[(n(!0),i(g,null,D($.value,s=>(n(),i("div",{key:s.inspectionId,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors"},[t("div",Ie,[t("div",{class:V(["flex items-center justify-center w-10 h-10 rounded-full mr-3",[s.passed?"bg-green-100":"bg-red-100"]])},[s.passed?(n(),T(u(et),{key:0,class:"h-5 w-5 text-green-600"})):(n(),T(u(J),{key:1,class:"h-5 w-5 text-red-600"}))],2),t("div",Re,[t("div",ke,[t("span",Se,o(s.extinguisherCode),1),t("span",Ce,o(s.inspectionType),1)]),t("div",Te,o(s.locationName)+" â€¢ "+o(h(s.inspectionDate)),1)])]),t("div",Fe,[s.requiresService?(n(),i("span",Ne," Service ")):I("",!0),s.requiresReplacement?(n(),i("span",$e," Replace ")):I("",!0)])]))),128))])):(n(),i("div",je," No recent inspections "))])])],64))])]),_:1}))}};export{ze as default};
