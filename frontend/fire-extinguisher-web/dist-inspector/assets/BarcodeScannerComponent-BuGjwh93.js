import{r as i,o as Q,a as M,b as u,f as t,h as I,e as y,A as V,x as H,t as h,T as W,q as P,v as K,B as j,C as q,p as $,g as c}from"./vendor-8rVgzruD.js";import{H as z,a as s}from"./barcode-DbNRVkGT.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"barcode-scanner"},X={key:0,class:"format-badge","data-testid":"format-badge"},Z={key:0,class:"manual-capture"},G=["disabled"],Y={key:0,class:"capture-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},ee={key:1,class:"scanning-animation-small"},ae={class:"scanning-status"},te={key:0,class:"status-scanning"},se={key:1,class:"status-success","data-testid":"scan-success"},oe={key:2,class:"status-error","data-testid":"scan-error"},ne={class:"manual-entry","data-testid":"manual-entry"},le={class:"manual-entry-content"},re=["disabled"],ie={__name:"BarcodeScannerComponent",props:{scanType:{type:String,default:"extinguisher",validator:g=>["location","extinguisher"].includes(g)},autoStart:{type:Boolean,default:!0}},emits:["scan-success","scan-error"],setup(g,{expose:k,emit:B}){const T=g,x=B,p=i(null),r=i(!1),f=i(""),d=i(!1),o=i(""),v=i(!1),m=i(""),C=i("CODE_39"),U=e=>({CODE_39:"Code 39 (3 of 9)",CODE_128:"Code 128",CODE_93:"Code 93",QR_CODE:"QR Code",EAN_13:"EAN-13",EAN_8:"EAN-8",UPC_A:"UPC-A",UPC_E:"UPC-E",CODABAR:"Codabar",ITF:"ITF (Interleaved 2 of 5)",DATA_MATRIX:"Data Matrix",PDF_417:"PDF-417",AZTEC:"Aztec"})[e]||e,w=(e,a)=>(a==="CODE_39"&&(e=e.replace(/\*/g,"")),e=e.trim(),e=e.toUpperCase(),e),D=async()=>{try{p.value=new z("reader"),r.value=!0,o.value="",await p.value.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250},formatsToSupport:[s.QR_CODE,s.CODE_128,s.CODE_39,s.CODE_93,s.EAN_13,s.EAN_8,s.UPC_A,s.UPC_E,s.CODABAR,s.ITF]},(e,a)=>{N(e,a)},e=>{})}catch(e){console.error("Camera access error:",e),r.value=!1,e.name==="NotAllowedError"?o.value="Camera access denied. Please enable camera permissions.":e.name==="NotFoundError"?o.value="No camera found on this device.":o.value="Failed to start camera. Please try manual entry.",x("scan-error",{error:e.message,type:"camera"})}},N=(e,a)=>{const n=a.result.format;f.value=n;let E=w(e,n);if(n==="QR_CODE")try{const b=JSON.parse(e);b.id&&(E=b.id)}catch{}d.value=!0,navigator.vibrate&&navigator.vibrate(200),A(),x("scan-success",{code:E,rawCode:e,format:n,manual:!1}),setTimeout(()=>{d.value=!1,f.value=""},2e3)},A=async()=>{if(p.value&&r.value)try{await p.value.stop(),r.value=!1}catch(e){console.error("Error stopping scanner:",e)}},R=async()=>{if(!(!p.value||!r.value||v.value))try{v.value=!0,o.value="";const e=document.querySelector("#reader video");if(!e)throw new Error("Camera video not found");const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight,a.getContext("2d").drawImage(e,0,0,a.width,a.height);const E=await new Promise(F=>{a.toBlob(F,"image/jpeg",.95)}),b=new File([E],"capture.jpg",{type:"image/jpeg"}),l=await p.value.scanFileV2(b,!0),O={result:{format:"UNKNOWN",text:l}};let _="UNKNOWN";l.length===13&&/^\d+$/.test(l)?_="EAN_13":l.length===12&&/^\d+$/.test(l)?_="UPC_A":l.startsWith("{")||l.startsWith("[")?_="QR_CODE":/^\*.*\*$/.test(l)&&(_="CODE_39"),O.result.format=_,N(l,O)}catch(e){console.error("Manual capture error:",e),o.value="Could not read barcode. Try positioning it more clearly in the frame.",setTimeout(()=>{o.value=""},3e3)}finally{v.value=!1}},S=()=>{if(!m.value)return;const e=w(m.value,C.value);d.value=!0,f.value=C.value,x("scan-success",{code:e,rawCode:m.value,format:C.value,manual:!0}),m.value="",setTimeout(()=>{d.value=!1,f.value=""},2e3)};return Q(()=>{T.autoStart&&D()}),M(()=>{A()}),k({startScanner:D,stopScanner:A}),(e,a)=>(c(),u("div",L,[t("div",{id:"reader",class:V(["scanner-viewport",{"scanner-active":r.value}])},null,2),I(W,{name:"fade"},{default:H(()=>[f.value?(c(),u("div",X,h(U(f.value)),1)):y("",!0)]),_:1}),r.value&&!d.value?(c(),u("div",Z,[t("button",{onClick:R,class:"btn-capture",disabled:v.value,"data-testid":"manual-capture-button"},[v.value?(c(),u("div",ee)):(c(),u("svg",Y,[...a[2]||(a[2]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("circle",{cx:"12",cy:"12",r:"3"},null,-1)])])),t("span",null,h(v.value?"Scanning...":"Capture Now"),1)],8,G),a[3]||(a[3]=t("p",{class:"capture-hint"},"Press if auto-scan isn't working",-1))])):y("",!0),t("div",ae,[r.value&&!d.value&&!v.value?(c(),u("div",te,[a[4]||(a[4]=t("div",{class:"scanning-animation"},null,-1)),t("p",null,h(g.scanType==="location"?"Scan Location QR Code":"Scan Extinguisher Barcode"),1)])):y("",!0),d.value?(c(),u("div",se,[...a[5]||(a[5]=[t("svg",{class:"icon-success",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12"})],-1),t("p",null,"Scan Successful!",-1)])])):y("",!0),o.value?(c(),u("div",oe,[a[6]||(a[6]=t("svg",{class:"icon-error",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),t("p",null,h(o.value),1)])):y("",!0)]),t("div",ne,[t("details",null,[a[8]||(a[8]=t("summary",{class:"manual-entry-toggle"},"Enter barcode manually",-1)),t("div",le,[P(t("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>m.value=n),type:"text",placeholder:"Enter barcode code",class:"manual-input","data-testid":"manual-code-input",onKeyup:j(S,["enter"])},null,544),[[K,m.value]]),P(t("select",{"onUpdate:modelValue":a[1]||(a[1]=n=>C.value=n),class:"format-select","data-testid":"manual-format-select"},[...a[7]||(a[7]=[$('<option value="CODE_39" data-v-12e2357f>Code 39 (3 of 9)</option><option value="CODE_128" data-v-12e2357f>Code 128</option><option value="QR_CODE" data-v-12e2357f>QR Code</option><option value="EAN_13" data-v-12e2357f>EAN-13</option><option value="UPC_A" data-v-12e2357f>UPC-A</option><option value="OTHER" data-v-12e2357f>Other</option>',6)])],512),[[q,C.value]]),t("button",{onClick:S,class:"btn-manual-submit","data-testid":"manual-submit-button",disabled:!m.value}," Submit ",8,re)])])]),a[9]||(a[9]=t("div",{class:"help-text"},[t("p",null,"Position the barcode within the frame. Scanner supports:"),t("ul",null,[t("li",null,"QR Codes"),t("li",null,"Code 39 (3 of 9)"),t("li",null,"Code 128"),t("li",null,"EAN/UPC barcodes")])],-1))]))}},ve=J(ie,[["__scopeId","data-v-12e2357f"]]);export{ve as B};
