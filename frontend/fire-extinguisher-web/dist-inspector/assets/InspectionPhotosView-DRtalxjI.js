import{r,c as g,G as S,a as D,b as c,f as t,p as N,e as k,F,E as I,t as b,u as A,g as d}from"./vendor-8rVgzruD.js";import{u as L}from"./index-DcSKaWik.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"inspection-photos"},$={class:"photos-content"},j={class:"photo-grid","data-testid":"photo-grid"},H=["data-testid"],O=["src","alt"],R=["onClick","data-testid"],T={class:"photo-label"},G={class:"photo-info","data-testid":"photo-info"},W={class:"action-buttons"},Y=["disabled"],q={key:0,class:"camera-modal"},z={class:"camera-container"},J={key:1,class:"alert-error","data-testid":"camera-error"},x=5,K={__name:"InspectionPhotosView",setup(Q){const p=A(),f=L(),a=r([]),i=r(!1),n=r(null),u=r(null),l=r(""),h=r("environment");g(()=>f.currentLocation),g(()=>f.currentExtinguisher),g(()=>f.currentInspection);const y=async()=>{l.value="";try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:h.value,width:{ideal:1920},height:{ideal:1080}},audio:!1});u.value=o,n.value&&(n.value.srcObject=o)}catch(o){console.error("Camera error:",o);let e="Failed to access camera";o.name==="NotAllowedError"||o.name==="PermissionDeniedError"?e="Camera permission denied. Please allow camera access in your browser settings.":o.name==="NotFoundError"||o.name==="DevicesNotFoundError"?e="No camera found on this device.":(o.name==="NotReadableError"||o.name==="TrackStartError")&&(e="Camera is already in use by another application."),l.value=e,i.value=!1}},C=()=>{if(!n.value||!u.value){l.value="Camera not available";return}const o=document.createElement("canvas"),e=n.value;o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,o.width,o.height);const s=o.toDataURL("image/jpeg",.85);a.value.push({dataUrl:s,timestamp:Date.now(),facingMode:h.value}),v(),i.value=!1},w=()=>{v(),i.value=!1},M=async()=>{h.value=h.value==="environment"?"user":"environment",v(),await y()},E=o=>{confirm("Delete this photo?")&&a.value.splice(o,1)},v=()=>{u.value&&(u.value.getTracks().forEach(o=>o.stop()),u.value=null),n.value&&(n.value.srcObject=null)},B=()=>{a.value.length>0?confirm("Are you sure? Your photos will be lost.")&&p.push("/inspector/inspection-checklist"):p.push("/inspector/inspection-checklist")},P=()=>{p.push("/inspector/inspection-signature")},_=()=>{if(a.value.length===0){l.value="Please add at least one photo or click Skip";return}p.push("/inspector/inspection-signature")};return S(i,async o=>{o?await y():v()}),D(()=>{v()}),(o,e)=>(d(),c("div",V,[t("div",{class:"photos-header"},[t("button",{onClick:B,class:"btn-back","data-testid":"back-button"},[...e[1]||(e[1]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])]),e[2]||(e[2]=t("h1",{class:"photos-heading","data-testid":"page-heading"},"Add Photos",-1)),e[3]||(e[3]=t("div",{class:"header-spacer"},null,-1))]),e[13]||(e[13]=N('<div class="instructions" data-v-d74f4ebb><div class="instruction-icon" data-v-d74f4ebb><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-d74f4ebb><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-d74f4ebb></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-d74f4ebb></circle><path d="M21 15l-5-5L5 21" data-v-d74f4ebb></path></svg></div><p class="instruction-text" data-v-d74f4ebb>Add inspection photos</p><p class="instruction-subtext" data-v-d74f4ebb>Take photos of the extinguisher and any deficiencies (optional but recommended)</p></div>',1)),t("div",$,[t("div",j,[(d(!0),c(F,null,I(a.value,(m,s)=>(d(),c("div",{key:s,class:"photo-item","data-testid":`photo-item-${s}`},[t("img",{src:m.dataUrl||m.url,alt:`Photo ${s+1}`,class:"photo-thumbnail"},null,8,O),t("button",{onClick:X=>E(s),class:"btn-delete-photo","data-testid":`btn-delete-${s}`},[...e[4]||(e[4]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,R),t("div",T,"Photo "+b(s+1),1)],8,H))),128)),a.value.length<x?(d(),c("button",{key:0,onClick:e[0]||(e[0]=m=>i.value=!0),class:"btn-add-photo","data-testid":"btn-add-photo"},[...e[5]||(e[5]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),t("path",{d:"M21 15l-5-5L5 21"})],-1),t("span",null,"Add Photo",-1)])])):k("",!0)]),t("div",G,[t("span",null,b(a.value.length)+" of "+b(x)+" photos added",1),e[6]||(e[6]=t("span",{class:"info-optional"},"(Optional)",-1))])]),t("div",W,[t("button",{onClick:P,class:"btn-skip","data-testid":"btn-skip"},[...e[7]||(e[7]=[t("span",null,"Skip Photos",-1)])]),t("button",{onClick:_,class:"btn-continue","data-testid":"btn-continue",disabled:a.value.length===0},[...e[8]||(e[8]=[t("span",null,"Continue",-1),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M5 12h14M12 5l7 7-7 7"})],-1)])],8,Y)]),i.value?(d(),c("div",q,[t("div",z,[t("video",{ref_key:"videoElement",ref:n,autoplay:"",playsinline:"",class:"camera-video","data-testid":"camera-video"},null,512),t("div",{class:"camera-controls"},[t("button",{onClick:w,class:"btn-camera-cancel","data-testid":"btn-cancel-camera"},[...e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),t("span",null,"Cancel",-1)])]),t("button",{onClick:C,class:"btn-camera-capture","data-testid":"btn-capture-photo"},[...e[10]||(e[10]=[t("div",{class:"capture-ring"},[t("div",{class:"capture-button"})],-1)])]),t("button",{onClick:M,class:"btn-camera-switch","data-testid":"btn-switch-camera"},[...e[11]||(e[11]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})],-1),t("span",null,"Flip",-1)])])])])])):k("",!0),l.value?(d(),c("div",J,[e[12]||(e[12]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),t("span",null,b(l.value),1)])):k("",!0)]))}},ot=U(K,[["__scopeId","data-v-d74f4ebb"]]);export{ot as default};
