import{r as d,o as S,b as s,f as t,e as l,p as b,h as k,t as n,u as _,g as i}from"./vendor-8rVgzruD.js";import{u as P}from"./index-DcSKaWik.js";import{B as C}from"./BarcodeScannerComponent-BuGjwh93.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./barcode-DbNRVkGT.js";const E={class:"scan-location"},G={key:0,class:"instructions"},L={key:1,class:"scanner-container"},A={key:2,class:"location-info","data-testid":"location-info"},I={class:"info-card"},M={class:"info-row"},N={class:"info-value","data-testid":"location-name"},V={class:"info-row"},R={class:"info-value","data-testid":"location-building"},F={class:"info-row"},Q={class:"info-value","data-testid":"location-floor"},D={key:0,class:"info-card","data-testid":"gps-info"},H={class:"info-row"},O={class:"info-value","data-testid":"gps-latitude"},J={class:"info-row"},$={class:"info-value","data-testid":"gps-longitude"},j={class:"info-row"},q={class:"info-value","data-testid":"gps-accuracy"},z={key:1,class:"gps-loading","data-testid":"gps-loading"},K={key:2,class:"alert-error","data-testid":"gps-error"},T=["disabled"],U={key:3,class:"alert-error","data-testid":"scan-error"},W={__name:"ScanLocationView",setup(X){const p=_(),f=P(),e=d(null),r=d(null),u=d(!1),v=d(""),c=d(""),y=async a=>{c.value="";try{let o;if(a.format==="QR_CODE")try{if(o=JSON.parse(a.text),o.type!=="location"||!o.locationId)throw new Error("Invalid location QR code")}catch{throw new Error("Invalid QR code format. Please scan a location QR code.")}else o={type:"location",locationId:a.text,name:`Location ${a.text}`,building:null,floor:null};e.value=o,await x(),f.setCurrentLocation({...o,gps:r.value,scannedAt:new Date().toISOString()})}catch(o){c.value=o.message,e.value=null}},m=a=>{c.value=a.message||"Failed to scan barcode"},x=async()=>{u.value=!0,v.value="";try{if(!navigator.geolocation)throw new Error("GPS not supported on this device");const a=await new Promise((o,g)=>{navigator.geolocation.getCurrentPosition(o,g,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});r.value={latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,timestamp:a.timestamp}}catch(a){let o="Failed to capture GPS location";a.code===1?o="GPS permission denied. Please allow location access.":a.code===2?o="GPS position unavailable. Please try again.":a.code===3&&(o="GPS timeout. Please try again."),v.value=o,console.error("GPS Error:",a)}finally{u.value=!1}},h=()=>{p.push("/inspector/dashboard")},w=()=>{if(!e.value){c.value="Please scan a location first";return}p.push("/inspector/scan-extinguisher")};return S(async()=>{if(navigator.geolocation)try{await new Promise((a,o)=>{navigator.geolocation.getCurrentPosition(a,o,{enableHighAccuracy:!1,timeout:5e3,maximumAge:1/0})})}catch{console.log("GPS permission not granted yet")}}),(a,o)=>(i(),s("div",E,[t("div",{class:"scan-header"},[t("button",{onClick:h,class:"btn-back","data-testid":"back-button"},[...o[0]||(o[0]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])]),o[1]||(o[1]=t("h1",{class:"scan-heading","data-testid":"page-heading"},"Scan Location",-1)),o[2]||(o[2]=t("div",{class:"header-spacer"},null,-1))]),e.value?l("",!0):(i(),s("div",G,[...o[3]||(o[3]=[b('<div class="instruction-icon" data-v-53e781cd><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-53e781cd><rect x="3" y="11" width="18" height="11" rx="2" ry="2" data-v-53e781cd></rect><path d="M7 11V7a5 5 0 0110 0v4" data-v-53e781cd></path></svg></div><p class="instruction-text" data-v-53e781cd>Scan the location QR code</p><p class="instruction-subtext" data-v-53e781cd>Position the QR code within the frame</p>',3)])])),e.value?l("",!0):(i(),s("div",L,[k(C,{onScanSuccess:y,onScanError:m,"data-testid":"barcode-scanner"})])),e.value?(i(),s("div",A,[o[15]||(o[15]=t("div",{class:"success-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M22 11.08V12a10 10 0 11-5.93-9.14"}),t("polyline",{points:"22 4 12 14.01 9 11.01"})])],-1)),t("div",I,[o[7]||(o[7]=t("h2",{class:"info-heading"},"Location Scanned",-1)),t("div",M,[o[4]||(o[4]=t("span",{class:"info-label"},"Name:",-1)),t("span",N,n(e.value.name),1)]),t("div",V,[o[5]||(o[5]=t("span",{class:"info-label"},"Building:",-1)),t("span",R,n(e.value.building||"N/A"),1)]),t("div",F,[o[6]||(o[6]=t("span",{class:"info-label"},"Floor:",-1)),t("span",Q,n(e.value.floor||"N/A"),1)])]),r.value?(i(),s("div",D,[o[11]||(o[11]=t("h2",{class:"info-heading"},"GPS Location",-1)),t("div",H,[o[8]||(o[8]=t("span",{class:"info-label"},"Latitude:",-1)),t("span",O,n(r.value.latitude.toFixed(6)),1)]),t("div",J,[o[9]||(o[9]=t("span",{class:"info-label"},"Longitude:",-1)),t("span",$,n(r.value.longitude.toFixed(6)),1)]),t("div",j,[o[10]||(o[10]=t("span",{class:"info-label"},"Accuracy:",-1)),t("span",q,"Â± "+n(r.value.accuracy.toFixed(0))+"m",1)])])):l("",!0),u.value?(i(),s("div",z,[...o[12]||(o[12]=[t("svg",{class:"loading-spinner",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none","stroke-dasharray":"32","stroke-dashoffset":"32"})],-1),t("span",null,"Capturing GPS location...",-1)])])):l("",!0),v.value?(i(),s("div",K,[o[13]||(o[13]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),t("span",null,n(v.value),1)])):l("",!0),t("button",{onClick:w,class:"btn-continue","data-testid":"continue-button",disabled:u.value},[...o[14]||(o[14]=[t("span",null,"Continue to Extinguisher Scan",-1),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M5 12h14M12 5l7 7-7 7"})],-1)])],8,T)])):l("",!0),c.value?(i(),s("div",U,[o[16]||(o[16]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),t("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)),t("span",null,n(c.value),1)])):l("",!0)]))}},eo=B(W,[["__scopeId","data-v-53e781cd"]]);export{eo as default};
