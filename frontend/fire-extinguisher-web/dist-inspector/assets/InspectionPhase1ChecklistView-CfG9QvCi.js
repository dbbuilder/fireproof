import{d as W,r as m,c as f,H as K,o as Q,G as X,b as l,f as e,e as u,h as Y,x as Z,i as ee,t as a,D as V,F as N,E as H,s as g,w as te,u as se,A as oe,q as le,v as re,g as r}from"./vendor-8rVgzruD.js";import{u as ne}from"./inspectionsPhase1-lLNUs6w2.js";import{u as ae}from"./checklistTemplates-CAJuC8xZ.js";import"./index-DcSKaWik.js";const ie={class:"min-h-screen bg-gray-50 pb-24"},de={class:"bg-white border-b border-gray-200 sticky top-0 z-10"},ue={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ce={class:"flex items-center justify-between h-16"},me={class:"w-full bg-gray-200 h-1"},pe={key:0,class:"max-w-2xl mx-auto px-4 py-6"},ve={class:"bg-white rounded-lg shadow-soft p-4 mb-6"},he={class:"flex items-center justify-between"},xe={class:"font-medium text-gray-900"},ye={class:"text-xs text-gray-500"},fe={class:"text-right"},ge={class:"font-medium text-gray-900"},be={class:"space-y-4"},_e={class:"flex items-start mb-4"},ke={class:"flex-shrink-0 w-8 h-8 rounded-full bg-primary-100 text-primary-700 flex items-center justify-center font-semibold text-sm"},we={class:"ml-3 flex-1"},Ie={class:"text-base font-medium text-gray-900"},Ce={class:"text-xs text-gray-500 mt-1"},je={class:"flex items-center mt-2 space-x-2"},Pe={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},Me={key:1,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800"},$e={class:"grid grid-cols-3 gap-3 mb-4"},ze=["onClick"],Fe={class:"h-6 w-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Re={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},Te={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},qe={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"},Ae={key:0,class:"mb-4"},Be=["for"],Se={key:0,class:"text-red-600"},Ve=["id","onUpdate:modelValue","placeholder"],Ne={key:1},He=["onClick"],Ee={key:0,class:"ml-1 text-red-600"},De={key:0,class:"text-xs text-green-600 mt-1 text-center"},Le={key:0,class:"mt-4 flex items-center justify-center text-sm text-gray-600"},Oe={key:1,class:"mt-4 text-center text-sm text-gray-500"},Ue={key:1,class:"flex items-center justify-center min-h-screen"},Ge={key:2,class:"max-w-2xl mx-auto px-4 py-12"},Je={class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},We={class:"text-red-800"},Ke={key:3,class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-10"},Qe={class:"max-w-2xl mx-auto px-4 py-3"},Xe=["disabled"],Ye={class:"space-y-3"},Ze={class:"flex items-center justify-between"},et={class:"text-sm font-medium text-gray-900"},tt={class:"w-full bg-gray-200 rounded-full h-2"},st={class:"flex items-center justify-between text-xs text-gray-500"},ut=W({__name:"InspectionPhase1ChecklistView",setup(ot){const E=K(),M=se(),$=ne(),D=ae(),d=m(null),x=m([]),o=m({}),I=m(!1),b=m(!1),_=m(!1),p=m(null),C=m(null),k=m(!1),w=f(()=>E.params.id),v=f(()=>x.value.length),y=f(()=>Object.keys(o.value).filter(n=>{const t=o.value[n],i=x.value.find(h=>h.itemId===n);return!(!i||!t.response||i.requiresComment&&!t.comment||i.requiresPhoto&&!t.photoId||t.response==="Fail"&&!t.comment)}).length),j=f(()=>v.value===0?0:Math.round(y.value/v.value*100)),P=f(()=>y.value===v.value&&v.value>0),L=n=>{try{const t=JSON.parse(n.allowedResponses);return Array.isArray(t)?t:["Pass","Fail","N/A"]}catch{return["Pass","Fail","N/A"]}},O=(n,t)=>{var h;return((h=o.value[n.itemId])==null?void 0:h.response)===t?t==="Pass"?"border-green-600 bg-green-50 text-green-700":t==="Fail"?"border-red-600 bg-red-50 text-red-700":"border-gray-600 bg-gray-50 text-gray-700":"border-gray-300 text-gray-600 hover:border-gray-400 hover:bg-gray-50"},U=(n,t)=>{o.value[n.itemId]?o.value[n.itemId].response=t:o.value[n.itemId]={response:t,comment:null,photoId:null},setTimeout(()=>z(),1e3)},z=async()=>{if(!b.value){b.value=!0,p.value=null;try{const n=Object.keys(o.value).filter(t=>o.value[t].response).map(t=>({checklistItemId:t,response:o.value[t].response,comment:o.value[t].comment||null,photoId:o.value[t].photoId||null}));n.length>0&&(await $.saveChecklistResponses(w.value,{responses:n}),C.value=new Date().toLocaleTimeString())}catch(n){p.value="Failed to save responses",console.error("Error saving responses:",n)}finally{b.value=!1}}},G=n=>{M.push({path:`/inspections/${w.value}/photo`,query:{itemId:n.itemId}})},J=async()=>{if(P.value){_.value=!0,p.value=null;try{await z(),M.push(`/inspections/${w.value}/complete`)}catch{p.value="Failed to proceed to completion"}finally{_.value=!1}}},F=async()=>{var n,t;I.value=!0,p.value=null;try{d.value=await $.fetchInspectionById(w.value,!0),d.value.templateId&&(x.value=await D.fetchTemplateItems(d.value.templateId)),d.value.checklistResponses?d.value.checklistResponses.forEach(i=>{o.value[i.checklistItemId]={response:i.response,comment:i.comment||null,photoId:i.photoId||null}}):x.value.forEach(i=>{o.value[i.itemId]||(o.value[i.itemId]={response:"",comment:null,photoId:null})})}catch(i){p.value=((t=(n=i.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to load inspection"}finally{I.value=!1}};return Q(()=>{F()}),X(o,()=>{},{deep:!0}),(n,t)=>{var h;const i=ee("router-link");return r(),l("div",ie,[e("div",de,[e("div",ue,[e("div",ce,[Y(i,{to:`/inspections/${(h=d.value)==null?void 0:h.inspectionId}`,class:"flex items-center text-gray-600 hover:text-gray-900"},{default:Z(()=>[...t[4]||(t[4]=[e("svg",{class:"h-6 w-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1},8,["to"]),t[5]||(t[5]=e("h1",{class:"text-lg font-semibold text-gray-900"}," Inspection Checklist ",-1)),e("button",{class:"text-sm text-primary-600 font-medium",onClick:t[0]||(t[0]=s=>k.value=!0)},a(y.value)+" / "+a(v.value),1)])]),e("div",me,[e("div",{class:"bg-primary-600 h-1 transition-all duration-300",style:V({width:`${j.value}%`})},null,4)])]),d.value&&x.value.length>0?(r(),l("div",pe,[e("div",ve,[e("div",he,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-600"}," Extinguisher ",-1)),e("p",xe,a(d.value.extinguisherAssetTag||d.value.extinguisherCode),1),e("p",ye,a(d.value.locationName),1)]),e("div",fe,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"}," Type ",-1)),e("p",ge,a(d.value.inspectionType),1)])])]),e("div",be,[(r(!0),l(N,null,H(x.value,(s,lt)=>{var R,T,q,A,B,S;return r(),l("div",{key:s.itemId,class:"bg-white rounded-lg shadow-soft p-6 animate-slide-up"},[e("div",_e,[e("div",ke,a(s.itemNumber),1),e("div",we,[e("h3",Ie,a(s.itemText),1),e("p",Ce,a(s.itemCategory),1),e("div",je,[s.requiresPhoto?(r(),l("span",Pe,[...t[8]||(t[8]=[e("svg",{class:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z","clip-rule":"evenodd"})],-1),g(" Photo ",-1)])])):u("",!0),s.isRequired?(r(),l("span",Me," Required ")):u("",!0)])])]),e("div",$e,[(r(!0),l(N,null,H(L(s),c=>(r(),l("button",{key:c,class:oe([O(s,c),"flex flex-col items-center justify-center py-3 px-2 rounded-lg border-2 transition-all text-sm font-medium"]),onClick:rt=>U(s,c)},[(r(),l("svg",Fe,[c==="Pass"?(r(),l("path",Re)):c==="Fail"?(r(),l("path",Te)):(r(),l("path",qe))])),g(" "+a(c),1)],10,ze))),128))]),s.requiresComment||((R=o.value[s.itemId])==null?void 0:R.response)==="Fail"?(r(),l("div",Ae,[e("label",{for:`comment-${s.itemId}`,class:"block text-sm font-medium text-gray-700 mb-1"},[g(a(((T=o.value[s.itemId])==null?void 0:T.response)==="Fail"?"Why did this fail?":"Comment")+" ",1),s.requiresComment?(r(),l("span",Se,"*")):u("",!0)],8,Be),le(e("textarea",{id:`comment-${s.itemId}`,"onUpdate:modelValue":c=>o.value[s.itemId].comment=c,rows:"2",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm",placeholder:((q=o.value[s.itemId])==null?void 0:q.response)==="Fail"?"Describe the issue...":"Optional comment..."},null,8,Ve),[[re,o.value[s.itemId].comment]])])):u("",!0),s.requiresPhoto||(A=o.value[s.itemId])!=null&&A.photoId?(r(),l("div",Ne,[e("button",{class:"w-full flex items-center justify-center px-4 py-2 border border-dashed border-gray-300 rounded-lg text-sm text-gray-600 hover:border-primary-500 hover:bg-primary-50 transition-colors",onClick:c=>G(s)},[t[9]||(t[9]=e("svg",{class:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),g(" "+a((B=o.value[s.itemId])!=null&&B.photoId?"Change Photo":"Take Photo")+" ",1),s.requiresPhoto?(r(),l("span",Ee,"*")):u("",!0)],8,He),(S=o.value[s.itemId])!=null&&S.photoId?(r(),l("p",De," âœ“ Photo captured ")):u("",!0)])):u("",!0)])}),128))]),b.value?(r(),l("div",Le,[...t[10]||(t[10]=[e("svg",{class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" Saving... ",-1)])])):C.value?(r(),l("p",Oe," Last saved "+a(C.value),1)):u("",!0)])):I.value?(r(),l("div",Ue,[...t[11]||(t[11]=[e("svg",{class:"animate-spin h-12 w-12 text-primary-600",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):p.value?(r(),l("div",Ge,[e("div",Je,[e("p",We,a(p.value),1),e("button",{class:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",onClick:F}," Retry ")])])):u("",!0),d.value?(r(),l("div",Ke,[e("div",Qe,[e("button",{disabled:!P.value||_.value,class:"w-full px-6 py-3 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors shadow-sm",onClick:J},a(_.value?"Completing...":P.value?"Complete Inspection":`Complete ${y.value}/${v.value} Items`),9,Xe)])])):u("",!0),k.value?(r(),l("div",{key:4,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t[3]||(t[3]=s=>k.value=!1)},[e("div",{class:"bg-white rounded-lg p-6 max-w-sm w-full",onClick:t[2]||(t[2]=te(()=>{},["stop"]))},[t[13]||(t[13]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"}," Inspection Progress ",-1)),e("div",Ye,[e("div",Ze,[t[12]||(t[12]=e("span",{class:"text-sm text-gray-600"},"Completed",-1)),e("span",et,a(y.value)+" / "+a(v.value),1)]),e("div",tt,[e("div",{class:"bg-primary-600 h-2 rounded-full transition-all",style:V({width:`${j.value}%`})},null,4)]),e("div",st,[e("span",null,a(j.value)+"% Complete",1),e("span",null,a(v.value-y.value)+" remaining",1)])]),e("button",{class:"mt-6 w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",onClick:t[1]||(t[1]=s=>k.value=!1)}," Close ")])])):u("",!0)])}}});export{ut as default};
